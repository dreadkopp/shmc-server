/**!
 * OS.js - JavaScript Cloud/Web Desktop Platform
 *
 * Copyright (c) 2011-2017, Anders Evenrud <andersevenrud@gmail.com>
 * All rights reserved.
 * 
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met: 
 * 
 * 1. Redistributions of source code must retain the above copyright notice, this
 *    list of conditions and the following disclaimer. 
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution. 
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR
 * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * @author  Anders Evenrud <andersevenrud@gmail.com>
 * @licence Simplified BSD License
 */
window.OSjs=window.OSjs||{},function(t,e,o,n,i,s){"use strict";function p(t,o,n){e.apply(this,["ApplicationVNCWindow",{icon:o.icon,title:o.name,width:640,height:480,key_capture:!0},t,n]),this.connectionDialog=null,this.lastKeyboardinput=null,this.resizeTimeout=null}function c(t,o,n,i){e.apply(this,["ApplicationVNCDialog",{icon:o.icon,title:o.name,width:450,height:400,allow_resize:!1,allow_maximize:!1},t,n]),this.callback=i||function(){}}function r(e,o){t.apply(this,["ApplicationVNC",e,o]),this.rfb=null,this.connectionState=null,this.connectionSettings={host:"localhost",port:5901,token:"",path:"websockify",repeaterid:"",encrypt:"https:"===window.location.protocol,truecolor:!0,localcursor:!0,shared:!0,viewonly:!1,password:"",scaling:"off"}}p.prototype=Object.create(e.prototype),p.constructor=e.prototype,p.prototype.init=function(t,o,n){var i=e.prototype.init.apply(this,arguments),s=this;n.render(this,"VNCWindow",i);var p=n.find(this,"Canvas").$element.children[0],c={MenuConnect:function(){o.connect(s,p)},MenuDisconnect:function(){o.disconnect(s)},MenuClose:function(){s._close()}};return this._scheme.find(this,"SubmenuFile").on("select",function(t){c[t.detail.id]&&c[t.detail.id]()}),i},p.prototype.destroy=function(){this.resizeTimeout=clearTimeout(this.resizeTimeout),e.prototype.destroy.apply(this,arguments)},p.prototype._focus=function(){return!!e.prototype._focus.apply(this,arguments)&&(this._app&&this._app.toggleFocus(!0),!0)},p.prototype._blur=function(){return!!e.prototype._blur.apply(this,arguments)&&(this._app&&this._app.toggleFocus(!1),!0)},p.prototype._blur=function(){return!!e.prototype._blur.apply(this,arguments)&&(this._app&&this._app.toggleFocus(!1),!0)},p.prototype._resize=function(){if(e.prototype._resize.apply(this,arguments)){if(this._app&&this._app.rfb&&this._scheme){var t=this._app.rfb,o=t.get_display();if(o){var n=this._app.connectionSettings.scaling,i=this._scheme.find(this,"Canvas").$element,s={w:i.offsetWidth,h:i.offsetHeight};if("remote"===n)this.resizeTimeout=clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(function(){o&&(o.set_maxWidth(s.w),o.set_maxHeight(s.h),t.setDesktopSize(s.w,s.h))},500);else if("scale"===n||"downscale"===n){var p="downscale"===n,c=o.autoscale(s.w,s.h,p);t.get_mouse().set_scale(c)}}}return!0}return!1},p.prototype.setStatus=function(t,e){var o=t;e&&(o+=": "+e);var n=this._scheme.find(this,"Statusbar");n&&n.set("value",o)},p.prototype.openConnectionDialog=function(t){var e=this;if(this.connectionDialog)return void this.connectionDialog._focus();var o=new c(this._app,this._app.__metadata,this._app.__scheme,function(o,n){e.connectionDialog=null,t(n)});this.connectionDialog=this._addChild(o,!0,!0)},c.prototype=Object.create(e.prototype),c.constructor=e.prototype,c.prototype.init=function(t,o,n){function i(){return{host:p._find("InputHost").get("value"),port:p._find("InputPort").get("value"),token:p._find("InputToken").get("value"),password:p._find("InputPassword").get("value"),path:p._find("InputPath").get("value"),repeaterid:p._find("InputRepeaterID").get("value"),encrypt:p._find("ToggleEncrypt").get("value"),truecolor:p._find("ToggleTrueColor").get("value"),shared:p._find("ToggleSharedMode").get("value"),viewonly:p._find("ToggleViewOnly").get("value"),localcursor:p._find("ToggleLocalCursor").get("value"),scaling:p._find("InputScalingMode").get("value")}}var s=e.prototype.init.apply(this,arguments),p=this;return n.render(this,"VNCDialog",s),this._find("InputHost").set("value",o.connectionSettings.host||"localhost"),this._find("InputPort").set("value",o.connectionSettings.port||5900),this._find("InputToken").set("value",o.connectionSettings.token||""),this._find("InputPassword").set("value",o.connectionSettings.password||""),this._find("InputPath").set("value",o.connectionSettings.path||"websockify"),this._find("InputRepeaterID").set("value",o.connectionSettings.repeaterid||""),this._find("ToggleEncrypt").set("value",o.connectionSettings.encrypt),this._find("ToggleTrueColor").set("value",o.connectionSettings.truecolor),this._find("ToggleSharedMode").set("value",o.connectionSettings.shared),this._find("ToggleViewOnly").set("value",o.connectionSettings.viewonly),this._find("ToggleLocalCursor").set("value",o.connectionSettings.localcursor),this._find("InputScalingMode").set("value",o.connectionSettings.scaling||"off"),this._find("ButtonOK").on("click",function(){p._close("ok",i())}),this._find("ButtonCancel").on("click",function(){p._close()}),s},c.prototype.destroy=function(){e.prototype.destroy.apply(this,arguments)},c.prototype._close=function(t,o){return this.callback(t,o),e.prototype._close.apply(this,arguments)},r.prototype=Object.create(t.prototype),r.constructor=t,r.prototype.destroy=function(){return this.disconnect(),t.prototype.destroy.apply(this,arguments)},r.prototype.init=function(e,o,n){var i=this;t.prototype.init.apply(this,arguments),e&&"object"==typeof e.lastConnection&&Object.keys(e.lastConnection).forEach(function(t){i.connectionSettings[t]=e.lastConnection[t]}),this._addWindow(new p(this,o,n))},r.prototype.onUpdateState=function(t,e,o,n){this.connectionState=e;var i=this._getMainWindow();i&&(i.setStatus(e,n),i._focus(!0))},r.prototype.onXvpInit=function(t){},r.prototype.onClipboard=function(t,e){},r.prototype.onFBUComplete=function(){this.rfb.set_onFBUComplete(function(){})},r.prototype.onFBResize=function(t,e,o){var n=this._getMainWindow();n&&n._resize(e+40,o+80,!0)},r.prototype.onDesktopName=function(t,e){var o=this._getMainWindow();o&&o._setTitle(e,!0)},r.prototype.connect=function(t,e){function o(){return n.rfb=new window.RFB({target:e,onUpdateState:function(){n.onUpdateState.apply(n,arguments)},onXvpInit:function(){n.onXvpInit.apply(n,arguments)},onClipboard:function(){n.onClipboard.apply(n,arguments)},onFBUComplete:function(){n.onFBUComplete.apply(n,arguments)},onFBResize:function(){n.onFBResize.apply(n,arguments)},onDesktopName:function(){n.onDesktopName.apply(n,arguments)}}),!0}var n=this;t.openConnectionDialog(function(e){e&&(n.disconnect(t),n._setSetting("lastConnection",e,!0),o()&&(Object.keys(e).forEach(function(t){n.connectionSettings[t]=e[t]}),n.rfb.set_encrypt(e.encrypt),n.rfb.set_true_color(e.truecolor),n.rfb.set_local_cursor(e.localcursor),n.rfb.set_shared(e.shared),n.rfb.set_view_only(e.viewonly),n.rfb.set_repeaterID(e.repeaterid),n.rfb.connect(e.host,e.port,e.password,e.path)))})},r.prototype.disconnect=function(t){this.rfb&&(this.rfb.disconnect(),this.rfb.set_onFBUComplete(this.FBUComplete)),this.rfb=null},r.prototype.toggleFocus=function(t){this.rfb&&(this.rfb.get_keyboard().set_focused(t),this.rfb.get_mouse().set_focused(t))},r.prototype.sendKey=function(t){this.rfb&&this.rfb.sendKey(t)},OSjs.Applications=OSjs.Applications||{},OSjs.Applications.ApplicationVNC=OSjs.Applications.ApplicationVNC||{},OSjs.Applications.ApplicationVNC.Class=r}(OSjs.Core.Application,OSjs.Core.Window,OSjs.Utils,OSjs.API,OSjs.VFS,OSjs.GUI);
//# sourceMappingURL=_app.min.js.map