/**!
 * OS.js - JavaScript Cloud/Web Desktop Platform
 *
 * Copyright (c) 2011-2017, Anders Evenrud <andersevenrud@gmail.com>
 * All rights reserved.
 * 
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met: 
 * 
 * 1. Redistributions of source code must retain the above copyright notice, this
 *    list of conditions and the following disclaimer. 
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution. 
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR
 * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * @author  Anders Evenrud <andersevenrud@gmail.com>
 * @licence Simplified BSD License
 */
window.OSjs=window.OSjs||{},function(e,t,i,n,r,o,a,c){"use strict";function l(e,t){"/"!==t.substr(0,1)&&(t="/"+t),"/"!=t&&(t=t.replace(/\/$/,""));var i=[];return(e||[]).forEach(function(e){var n="/"+e.filename;r.dirname(n)===t&&i.push(e)}),i.sort(function(e,t){return e.directory<t.directory?1:e.directory>t.directory?-1:0}),i}function p(e,i,n,r){t.apply(this,["ApplicationArchiverWindow",{allow_drop:!0,icon:i.icon,title:i.name,width:450,height:300},e,n,r])}var s=function(){var e=o.getConfig("MIME.mapping")||{};return function(t){if(t.directory)return"";var i="."+r.filext(t.filename);return e[i]||"application/octet-stream"}}();p.prototype=Object.create(t.prototype),p.constructor=t.prototype,p.prototype.init=function(e,i,n){function r(){var e=a._find("FileView").get("selected");return e&&e.length?e[0].data.filename:null}var o=t.prototype.init.apply(this,arguments),a=this;return this._render("ArchiverWindow"),this._find("MenuBar").on("select",function(e){"MenuExtract"===e.detail.id?i.action("extract"):"MenuRemove"===e.detail.id?i.action("remove",r()):"MenuAddFile"===e.detail.id?i.action("add",null):"MenuAddDirectory"===e.detail.id&&i.action("add","dir")}),this._find("FileView").on("activate",function(e){var t=e.detail.entries[0].data;t.directory&&i.action("chdir","/"+t.filename)}),this.renderProgress(!1),o},p.prototype.updateFile=function(e){t.prototype.updateFile.apply(this,arguments)},p.prototype.showFile=function(e,i){t.prototype.showFile.apply(this,arguments),this._app.action("open",e)},p.prototype.getFileData=function(){return null},p.prototype.renderProgress=function(e,t,i){if(this._scheme){var n=this._find("Progress"),r=this._find("Statusbar");n&&r&&(!0===e||!1===e?(n.hide().set("value",0),r.set("value","")):(n.show().set("value",Math.round(t/i*100)),r.set("value","Extracting: "+e)))}},p.prototype.renderArchive=function(e,t){if(this._scheme){var i=this._find("FileView"),n=[];"/"!==t&&n.push({value:{directory:!0,filename:(r.dirname(t)||"/").replace(/^\//,"")},columns:[{label:".."},{label:"",textalign:"right"},{label:0,textalign:"right"}]}),e&&(l(e,t).forEach(function(e){var t=r.filename(e.filename.replace(/\/$/,"")),i={type:e.directory?"dir":"file",filename:t,path:r.dirname(e.filename.replace(/\/$/,"")),mime:e.directory?null:s(e)};n.push({value:e,columns:[{label:r.filename(e.filename),icon:o.getFileIcon(i)},{label:s(e),textalign:"right"},{label:r.humanFileSize(e.uncompressedSize),textalign:"right"}]})}),i.set("columns",[{label:"Name",size:"100px"},{label:"Type",size:"100px",textalign:"right"},{label:"Size",size:"60px",textalign:"right"}])),i.clear(),i.add(n)}};var u=function(t,i){e.apply(this,["ApplicationArchiver",t,i,{readData:!1,extension:"zip",mime:"application/zip",filename:"New archive.zip"}]),this.currentArchive=null,this.currentPath="/"};u.prototype=Object.create(e.prototype),u.constructor=e,u.prototype.destroy=function(){return this.currentArchive=null,this.currentPath="/",e.prototype.destroy.apply(this,arguments)},u.prototype.init=function(e,t,n){i.prototype.init.call(this,e,t,n);var r=this._getArgument("file");this._addWindow(new p(this,t,n,r))},u.prototype.action=function(e,t,i){var n=this,r=this._getMainWindow(),a=this.currentArchive;r&&(r._toggleLoading(!0),OSjs.Helpers.ZipArchiver.createInstance({},function(c,l){if(r){if(r._toggleLoading(!1),c)return void o.createDialog("Error",{title:"Archiver error",message:"Cannot perform action",error:"No zip support: "+c},function(){},r);"add"===e?n.openAddDialog(a,t,function(e){e?l.add(a,e,{path:n.currentPath,oncomplete:function(){r._toggleLoading(!1),n.action("open",a,n.currentPath)}}):r._toggleLoading(!1)}):"extract"===e?(r._toggleLoading(!0),n.openExtractDialog(a,function(e){e?l.extract(a,e.path,{oncomplete:function(){r&&(r._toggleLoading(!1),r.renderProgress(!1))},onprogress:function(e,t,i){r&&r.renderProgress(e,t,i)},app:n}):r._toggleLoading(!1)})):"remove"===e?(r._toggleLoading(!0),l.remove(n.currentArchive,t,function(e){e&&alert(e),r._toggleLoading(!1),n.action("open",a,n.currentPath)})):"chdir"===e?n.action("open",n.currentArchive,t||"/"):"open"===e&&(n.currentArchive=t||null,n.currentPath=i||"/",r.renderArchive(null,n.currentPath),r._toggleLoading(!0),n.currentArchive?l.list(n.currentArchive,function(e,t){r._toggleLoading(!1),r.renderArchive(t,n.currentPath)}):(r._toggleLoading(!0),n.openCreateDialog(n.currentArchive,function(e){e?(e.mime="application/zip",n.currentArchive=e,l.create(e,function(){r._toggleLoading(!1),n._setArgument("file",e),r.updateFile(e),r.renderArchive([],n.currentPath)},n)):r._toggleLoading(!1)})))}}))},u.prototype.openCreateDialog=function(e,t){o.createDialog("File",{filename:"New Archive.zip",type:"save"},function(e,i,n){t("ok"===i?n:null)},{parent:this._getMainWindow(),modal:!0})},u.prototype.openExtractDialog=function(e,t){o.createDialog("File",{select:"dir"},function(e,i,n){t("ok"===i?n:null)},{parent:this._getMainWindow(),modal:!0})},u.prototype.openAddDialog=function(e,t,i){o.createDialog("File",{select:t},function(e,t,n){i("ok"===t?n:null)},{parent:this._getMainWindow(),modal:!0})},OSjs.Applications=OSjs.Applications||{},OSjs.Applications.ApplicationArchiver=OSjs.Applications.ApplicationArchiver||{},OSjs.Applications.ApplicationArchiver.Class=u}(OSjs.Helpers.DefaultApplication,OSjs.Helpers.DefaultApplicationWindow,OSjs.Core.Application,OSjs.Core.Window,OSjs.Utils,OSjs.API,OSjs.VFS,OSjs.GUI);
//# sourceMappingURL=_app.min.js.map